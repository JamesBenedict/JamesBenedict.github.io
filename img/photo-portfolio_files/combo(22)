YUI.add("fluid-magic-subnav-view",function(e){"use strict";e.FlickrView.create(this.name,e.namespace("Views")["fluid-subnav-view"],[],{langBundles:this.details.langBundles,loadState:function(){var e=[],t=this;return e.push(this.appContext.getModel("person-relationship-models",this.nsid).then(function(e){t.set("relationship",e)})),this.constructor.superclass.loadState.call(this,e)},activate:function(){return this.get("relationship")&&this.registerEventHandler(this.get("relationship").on("valuesChanged",this.handleDataChanged.bind(this))),this.constructor.superclass.activate.call(this)},handleDataChanged:function(e){"isIgnored"in e&&e.isIgnored.newVal===!1&&this.populateUrls(this.get("personModel"))},populateUrls:function(t){var n,r,i=this,s,o=!1,u=!1;n=e.URLHelper.generatePersonUrls(t),this.nsid!==this.appContext.getViewer().nsid&&(u=!0),this.get("relationship")&&this.get("relationship").getValue("isIgnored")&&(o=!0),this.set("links",[{name:this.intlMessage({intlName:"cameraroll.CAMERA_ROLL"}),id:"cameraroll",href:n.cameraroll,disabled:u},{name:this.intlMessage({intlName:"header.PHOTOSTREAM"}),id:"photostream",href:n.photostream},{name:this.intlMessage({intlName:"header.ALBUMS"}),id:"albums",href:n.albums},{name:this.intlMessage({intlName:"header.FAVORITES"}),id:"favorites",href:n.favorites},{name:this.intlMessage({intlName:"filter-bar.GROUPS"}),id:"groups",href:u?n.theirGroups:n.myGroups,disabled:u&&!this.appContext.flipper.isFlipped("enable-people-groups")},{name:this.intlMessage({intlName:"header.CREATIONS"}),id:"creations",href:n.creations,disabled:u},{name:this.intlMessage({intlName:"common.STATS"}),id:"stats",href:n.stats,disabled:u||!this.appContext.flipper.isFlipped("rebootify-stats")&&!this.get("personModel").getValue("isPro")}]),this.get("selected")&&(r=this.get("links").filter(function(e){return e.id===i.get("selected")}),r[0].selected=!0),s=[{text:this.intlMessage({intlName:"header.EDIT"}),href:n.edit,className:"server-only-link",hidden:u},{text:this.intlMessage({intlName:"header.MAP"}),href:n.map},{text:this.intlMessage({intlName:"common.GALLERIES"}),href:n.galleries},{text:this.intlMessage({intlName:"common.COLLECTIONS"}),href:n.collections},{text:this.intlMessage({intlName:"common.ARCHIVES"}),href:n.archives},{text:this.intlMessage({intlName:"common.TAGS"}),href:n.tags},{text:this.intlMessage({intlName:"common.PHOTOS_OF"}),href:n.photosOf},{text:this.intlMessage({intlName:"common.PROFILE"}),href:n.profile},{text:this.intlMessage({intlName:"common.POPULAR"}),href:n.popular,hidden:u},{text:this.intlMessage({intlName:"common.ACTIVITY"}),href:"/activity/",hidden:u},{text:this.intlMessage({intlName:"common.STATS"}),href:n.stats,hidden:u||!this.appContext.flipper.isFlipped("rebootify-stats")&&!this.get("personModel").getValue("isPro")},{text:this.intlMessage({intlName:"common.ORGANIZE"}),href:"/photos/organize/",hidden:u},{text:this.intlMessage({intlName:"header.GUESTPASS_HISTORY"}),href:"/invite/history/guests/",hidden:u},{text:this.intlMessage({intlName:"header.SEND_FLICKR_MAIL"}),href:"/mail/write/?to="+this.nsid,hidden:!u||!this.appContext.getViewer().signedIn},{text:this.intlMessage({intlName:"header.BLOCK"}),href:"/ignore.gne?id="+this.nsid,hidden:!u||o||!this.appContext.getViewer().signedIn}],this.set("moreLinks",s)}})},"@VERSION@",{requires:["flickr-view","fluid-subnav-view","url-helper"],langBundles:["filter-bar","header","common","cameraroll"]});
YUI.add("upload-file-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,t.PHOTO_FILE_EXTENSIONS=["jpg","jpeg","gif","png","tif","tiff","bmp"],t.VIDEO_FILE_EXTENSIONS=["3gp","3gp","avi","mov","mp4","mpg","mpeg","wmv","ogg","ogv","m2v"],e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(n){var r={id:n.id,file:n.file,filename:n.file.name,filesize:n.file.size},i=n.file.name.split("."),s=i[i.length-1];return s=/([A-Za-z0-9]+)/.exec(s),r.extension=s&&s[1]&&s[1].toLowerCase(),n.file.type&&(/^image\/.*$/.test(n.file.type)?r.mediaType="photo":/^video\/.*$/.test(n.file.type)&&(r.mediaType="video")),r.mediaType||r.extension&&(t.PHOTO_FILE_EXTENSIONS.indexOf(r.extension)>-1?r.mediaType="photo":t.VIDEO_FILE_EXTENSIONS.indexOf(r.extension)>-1&&(r.mediaType="video")),r.mediaType||(r.mediaType="invalid"),this.add(r),e.Promise.resolve(r)}},removeXHR:function(e){var t=this.getValue(e,"xhr");this.setValue(e,"xhr",null),t&&t.abort()},incrementNumTicketChecks:function(e){var t=this.getValue(e,"numTicketChecks");this.setValue(e,"numTicketChecks",t+1)},incrementNumRetries:function(e){var t=this.getValue(e,"numRetries");this.setValue(e,"numRetries",t+1)},addError:function(e,t){var n=this.getValue(e,"errors"),r=n.some(function(e){return e.type===t.type});r||(n.push(t),this.setValue(e,"errors",n))},attributes:{file:{},filename:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},filesize:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},mediaType:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},extension:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},isVideo:{readOnly:!0,derivedBy:["mediaType"],getter:function(e,t){var n=this.getValue(t,"mediaType");return n==="video"}},isValidFiletype:{readOnly:!0,derivedBy:["mediaType"],getter:function(e,t){var n=this.getValue(t,"mediaType");return n==="photo"||n==="video"}},bytesLoaded:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},bytesTotal:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},percentageLoaded:{readOnly:!0,derivedBy:["bytesLoaded","bytesTotal"],getter:function(e,t){var n=Math.ceil(this.getValue(t,"bytesLoaded")/this.getValue(t,"bytesTotal")*100);return n=Math.max(0,Math.min(e,100)),n}},xhr:{validator:function(e,t){return!e||e instanceof XMLHttpRequest},defaultValue:null},ticketId:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},numTicketChecks:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},numRetries:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},errors:{setter:function(e){return e?e instanceof Array||(e=[e]):e=[],e},defaultValue:[]},photoId:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:null}}})},"@VERSION@",{requires:["flickr-model-registry","attribute-helpers"]});
YUI.add("upload-error",function(e){var t=e.UploadError=function(e,n){this.type=e||t.types.GENERIC,this.message=n||""};t.prototype={getIntlKey:function(){return"uploader."+this.type},isRetryable:function(){return[t.types.FILE_UPLOAD_TIMEOUT,t.types.FILE_UPLOAD_FAILED].indexOf(this.type)!==-1},getUserFacingCategory:function(){switch(this.type){case t.types.INVALID_FILE:case t.types.FILE_TOO_SMALL:case t.types.FILE_TOO_LARGE:return t.userFacingCategories.INVALID_FILE;default:return t.userFacingCategories.GENERIC}}},t.types={GENERIC:"GENERIC",INVALID_FILE:"INVALID_FILE",TOO_MANY_FILES:"TOO_MANY_FILES",FILE_TOO_SMALL:"FILE_TOO_SMALL",FILE_TOO_LARGE:"FILE_TOO_LARGE",OVER_VIDEO_LIMIT:"OVER_VIDEO_LIMIT",OVER_BANDWIDTH_LIMIT:"OVER_BANDWIDTH_LIMIT",VIDEO_UPLOADS_DISABLED:"VIDEO_UPLOADS_DISABLED",FILE_UPLOAD_TIMEOUT:"FILE_UPLOAD_TIMEOUT",FILE_UPLOAD_ABORTED:"FILE_UPLOAD_ABORTED",FILE_UPLOAD_FAILED:"FILE_UPLOAD_FAILED",DUPLICATE_FILE:"DUPLICATE_FILE"},t.userFacingCategories={GENERIC:"GENERIC",TOO_MANY_FILES:"TOO_MANY_FILES",INVALID_FILE:"INVALID_FILE",CANCELED:"CANCELED",PROCESSING_ERROR:"PROCESSING_ERROR"}},"@VERSION@",{requires:[]});
YUI.add("upload-queue",function(e){"use strict";function l(){var e;c(),o=!1,u&&clearTimeout(u),a&&clearTimeout(a),f={progress:0,numFiles:0,numUploaded:0,numFailed:0};if(r)for(e in r)clearTimeout(r[e]);r={}}function c(){n={currentBatch:{},pending:[],transferring:{},waitingForTicket:{},transferred:{},checkingTicket:{},uploaded:{},failed:{}}}function h(t,r){if(YUI.Env.isServer)throw new Error("Y.UploadQueue creates a single object per session, and is designed for use only on the client.");i||(i=r,s=i.flipper.isFlipped("uploader-debugging")),t.forEach(function(t){n.currentBatch[t.id]=t;var r=!1;_(t)&&(L(t,e.UploadError.types.FILE_TOO_SMALL),r=!0),D(t)&&(L(t,e.UploadError.types.FILE_TOO_LARGE),r=!0),P(t)&&(L(t,e.UploadError.types.OVER_VIDEO_LIMIT),r=!0),H()&&(L(t,e.UploadError.types.OVER_BANDWIDTH_LIMIT),r=!0),B(t)&&(L(t,e.UploadError.types.VIDEO_UPLOADS_DISABLED),r=!0),r||(t.setValues({bytesLoaded:0,bytesTotal:t.getValue("filesize")}),n.pending.push(t))})}function p(t,r){i||(i=r,s=i.flipper.isFlipped("uploader-debugging")),t.forEach(function(t){n.currentBatch[t.id]=t,n.failed[t.id]=t,t.getValue("errors").forEach(function(n){e.UploadQueue.fire("error",{file:t,error:n})})})}function d(){j("========== batch started =========="),i.uploadIsInProgress()||(i.markUploadInProgress(!0),e.UploadQueue.fire("start",f)),!Object.keys(n.currentBatch).length||!n.pending.length?g():v()}function v(){var e;if(!n.pending.length)return;if(Object.keys(n.transferring).length>=t.maxParallelUploads)return;if(Object.keys(n.waitingForTicket).length>=t.maxParallelUploadsWaitingForTicket)return;e=n.pending.shift(),m(e)}function m(i){var s=new FormData,o=new XMLHttpRequest,u=e.config.flickr.api.hostname_client_upload,a,f,l,c,h,p;i.setValue("xhr",o),s.append("api_key",e.config.flickr.api.site_key),s.append("csrf",e.config.flickr.csrf.token),s.append("photo",i.getValue("file"),i.getValue("filename")),s.append("async","1"),s.append("is_public","0"),s.append("is_friend","0"),s.append("is_family","0"),s.append("hermes","1"),o.open("POST",u,!0),o.withCredentials=!0,a=f=function(t,n,r){n||(t&&t.type==="abort"?n=e.UploadError.types.FILE_UPLOAD_ABORTED:n=e.UploadError.types.FILE_UPLOAD_FAILED),r||(r=t?t.target.statusText:"");if(!p())return;i.removeXHR(),L(i,n,r),g()},l=function(t){var r,s,u,a;if(!p())return;if(o.status===200){if(!o.responseXML){L(i,e.UploadError.types.FILE_UPLOAD_FAILED,"Response XML failure");return}r=o.responseXML.documentElement,s=r.getAttribute("stat");if(s==="ok")i.setValue("ticketId",r.getElementsByTagName("ticketid")[0].firstChild.nodeValue),n.transferred[i.id]=i,b(i),v();else{u=r.getElementsByTagName("err"),a=u&&u[0]&&u[0].getAttribute("code");switch(parseInt(a,10)){case 5:L(i,e.UploadError.types.INVALID_FILE,s);break;case 6:L(i,e.UploadError.types.OVER_BANDWIDTH_LIMIT,s);break;case 7:L(i,e.UploadError.types.OVER_VIDEO_LIMIT,s);break;case 9:L(i,e.UploadError.types.DUPLICATE_FILE,s);break;default:L(i,e.UploadError.types.FILE_UPLOAD_FAILED,s)}}}else L(i,e.UploadError.types.FILE_UPLOAD_FAILED,"Upload API failure with status: "+o.status);i.removeXHR(),g()},c=function(e){var s,o;if(!e.lengthComputable)return;i.setValue("bytesLoaded",e.loaded),i.setValue("bytesTotal",e.total),g(),e.loaded>=e.total?(delete n.transferring[i.id],n.waitingForTicket[i.id]=i,v(),s=t.ticketReceiptTimeoutDelay):s=t.transferTimeoutDelay,o=r[i.id],o&&clearTimeout(o),r[i.id]=setTimeout(h,s)},h=function(){a(null,e.UploadError.types.FILE_UPLOAD_TIMEOUT)},p=function(){return i.getValue("xhr")?(o.removeEventListener("load",l),o.removeEventListener("error",a),o.removeEventListener("abort",f),o.upload.removeEventListener("progress",c),clearTimeout(r[i.id]),delete r[i.id],delete n.transferring[i.id],delete n.waitingForTicket[i.id],!0):!1},o.addEventListener("load",l),o.addEventListener("error",a),o.addEventListener("abort",f),o.upload.addEventListener("progress",c),n.transferring[i.id]=i,o.send(s)}function g(){if(!i.uploadIsInProgress())return;var r=Object.keys(n.currentBatch).length,s=Object.keys(n.uploaded).length,o=Object.keys(n.failed).length,u=0,l=0,c=0,h=f?f.progress:0,p,d;for(p in n.currentBatch){d=n.currentBatch[p];if(n.failed[d.id])continue;u+=d.getValue("bytesLoaded"),l+=d.getValue("bytesTotal")}o>=r?c=1:(c+=t.progressRatios.transferring*u/l,c+=t.progressRatios.flickrizing*s/(r-o)),f={progress:c,numFiles:r,numUploaded:s,numFailed:o},j("progress: ",f),e.UploadQueue.fire("progress",f),c>h&&(clearTimeout(a),a=setTimeout(M,t.networkOfflineTimeoutDelay)),c>=1&&O()}function y(){return e.merge(f)}function b(e){j("beginCheckingTicket() ticket id:",e.getValue("ticketId")),n.checkingTicket[e.id]=e,w()}function w(){if(o)return;var t=[],r={};Object.keys(n.checkingTicket).forEach(function(e){var i=n.checkingTicket[e],s=i.getValue("ticketId");t.push(s),r[s]=i}),j("open tickets:",t);if(!t.length)return;o=!0,i.callAPI("flickr.photos.upload.checkTickets",{tickets:t.join(",")}).then(function(t){j("ticket response:",t),t&&t.stat&&t.stat==="ok"&&t.uploader&&t.uploader.ticket instanceof Array?(t.uploader.ticket.forEach(function(t){var n=r[t.id];if(!n)return;parseInt(t.complete,10)===1?(n.setValue("photoId",t.photoid),k(n)):parseInt(t.complete,10)===2?L(n,e.UploadError.types.INVALID_FILE):parseInt(t.invalid,10)===1?L(n,e.UploadError.types.FILE_UPLOAD_FAILED):S(n)}),x(!0)):E()},E)}function E(e){var t,r;for(t in n.checkingTicket)r=n.checkingTicket[t],S(r);x(!1)}function S(n){n.incrementNumTicketChecks(),n.getValue("numTicketChecks")>=t.maxNumTicketChecks&&L(n,e.UploadError.types.FILE_UPLOAD_FAILED)}function x(e){o=!1;if(!Object.keys(n.checkingTicket).length)return;var r=t.ticketCheckPollTime[e?"afterOKResponse":"afterBadResponse"];u=setTimeout(w,r)}function T(e){j("retrying fileModel.id:",e.id),e.incrementNumRetries(),A(e),h([e],i)}function N(){var e;for(e in n.currentBatch)A(n.currentBatch[e]);O(!0)}function C(){var e;i.getModelRegistry("photostream-models").then(function(t){e=t.attributeSearch({normalizedId:i.getViewer().nsid},!0),e.forEach(function(e){t.remove
(e)})})}function k(t){A(t),n.uploaded[t.id]=t,e.UploadQueue.fire("success",{file:t}),g()}function L(r,i,s){var o=new e.UploadError(i,s),u=o.isRetryable();r.addError(o),e.Flog.error("Error during upload ("+i+":"+s+")"),e.UploadQueue.fire("error",{file:r,error:o}),u&&r.getValue("numRetries")<t.maxNumRetries?T(r):(n.failed[r.id]=r,A(r),e.UploadQueue.fire("fail",{file:r,error:o})),g(),v()}function A(e){var t=n.pending.indexOf(e.id);t!==-1&&n.pending.splice(t,1),delete n.transferring[e.id],delete n.waitingForTicket[e.id],delete n.transferred[e.id],delete n.checkingTicket[e.id],e.removeXHR()}function O(t){try{t?(j("========== batch canceled =========="),e.UploadQueue.fire("canceled")):(j("========== batch complete =========="),!Object.keys(n.uploaded).length||C(),e.UploadQueue.fire("complete",{uploaded:e.merge(n.uploaded),failed:e.merge(n.failed)}))}catch(r){e.Flog.error("Error in event handler onBatchComplete:",r)}i.markUploadInProgress(!1),l()}function M(){e.UploadQueue.fire("offline"),N()}function _(e){var t=e.getValue("filesize");return!t||t<=0}function D(e){var n=t.uploadLimits.pro.sizes.video,r=t.uploadLimits.pro.sizes.photo,i=e.getValue("filesize"),s=e.getValue("isVideo");return s&&i>n?!0:!s&&i>r?!0:!e.getValue("mediaType")&&i>r&&i>n?!0:!1}function P(e){return!1}function H(){var e=0;return e>t.uploadLimits.pro.monthlyBandwidthLimit}function B(e){return t.videoUploadsDisabled&&e.getValue("isVideo")}function j(){var e=Array.prototype.slice.call(arguments);e.unshift("[UPLOAD]"),s&&console.log.apply(console,e)}var t={maxParallelUploads:1,maxParallelUploadsWaitingForTicket:4,maxNumTicketChecks:100,maxNumRetries:2,videoUploadsDisabled:!1,editrBatchId:23,ticketCheckPollTime:{afterOKResponse:1e3,afterBadResponse:3e3},transferTimeoutDelay:15e3,ticketReceiptTimeoutDelay:6e4,networkOfflineTimeoutDelay:9e4,uploadLimits:{pro:{sizes:{photo:209715200,video:1073741824},videoCountMonthlyLimit:Number.MAX_VALUE,monthlyBandwidthLimit:214748364800},nonPro:{sizes:{photo:209715200,video:1073741824},videoCountMonthlyLimit:2,monthlyBandwidthLimit:214748364800}},progressRatios:{transferring:.65,flickrizing:.35,publishing:0,adding:0}},n,r,i,s=!1,o,u,a,f;(function(){l()})(),e.UploadQueue={addToQueue:h,addToFailedQueue:p,beginProcessing:d,getBatchProgress:y,cancelBatch:N},e.UploadQueue.exposedForUnitTests={queues:n,checkForNextUpload:v,fileSizeTooSmall:_,fileSizeTooLarge:D,fileOverVideosPerMonth:P,fileOverMonthlyBandwidth:H,fileIsDisabledVideo:B},e.augment(e.UploadQueue,e.EventTarget,!0,null,{emitFacade:!0})},"@VERSION@",{requires:["event-custom","upload-file-models","upload-error"]});
YUI.add("upload-file-picker",function(e,t){var n={selectors:{dropzone:".uploader-drop-zone",filePickerInput:"#uploader-input"},classes:{dropzoneActive:"active"},maxNumFiles:Number.POSITIVE_INFINITY,allowVideo:!0,allowedFileTypes:{photo:e.Models["upload-file-models"].PHOTO_FILE_EXTENSIONS.concat(),video:e.Models["upload-file-models"].VIDEO_FILE_EXTENSIONS.concat()},documentHandlesDragEvents:!0},r=e.UploadFilePicker=function(t,r){this.initedSuccessfully=!1;if(!this._fileAPIIsSupported())return;t=t?e.clone(t):{},this.config=e.merge(n,t),this.appContext=r,this.isUploading=!1,this.initUI(),e.UploadQueue.addTarget(this),this.initedSuccessfully=!0,this.dragDropTracker={},this.dragLeaveTimeout=null};r.prototype={initUI:function(){this.dropzone=e.one(this.config.selectors.dropzone),this.boundEventHandlers={inputChange:this.handleInputChange.bind(this),dragover:this.handleDragOver.bind(this),dragenter:this.handleDragEnter.bind(this),dragleave:this.handleDragLeave.bind(this),drop:this.handleDrop.bind(this)},this.filePickerInput=e.one(this.config.selectors.filePickerInput),this.filePickerInput&&this.filePickerInput.on("change",this.boundEventHandlers.inputChange),this.config.documentHandlesDragEvents?(e.config.doc.addEventListener("dragover",this.boundEventHandlers.dragover),e.config.doc.addEventListener("dragenter",this.boundEventHandlers.dragenter),e.config.doc.addEventListener("dragleave",this.boundEventHandlers.dragleave),e.config.doc.addEventListener("drop",this.boundEventHandlers.drop)):this.dropzone},disableUI:function(){if(!this.boundEventHandlers)return;this.filePickerInput&&this.filePickerInput.detach("change",this.boundEventHandlers.inputChange),this.config.documentHandlesDragEvents?(e.config.doc.removeEventListener("dragover",this.boundEventHandlers.dragover),e.config.doc.removeEventListener("dragenter",this.boundEventHandlers.dragenter),e.config.doc.removeEventListener("dragleave",this.boundEventHandlers.dragleave),e.config.doc.removeEventListener("drop",this.boundEventHandlers.drop)):this.dropzone,this.boundEventHandlers=null},reset:function(t){var n;if(this.dropzone)for(n in this.config.classes)this.dropzone.removeClass(this.config.classes[n]);t&&e.UploadQueue.cancelBatch()},destroy:function(){this.reset(!1),this.disableUI()},handleDragOver:function(e){e.stopImmediatePropagation(),e.preventDefault()},handleDragEnter:function(t){if(e.OverlayManager.ModalOverlay.alreadyShowingModal())return;var n=e.one(t.target).generateID();t.stopImmediatePropagation(),t.preventDefault(),Object.keys(this.dragDropTracker).length===0&&this.dropzone&&this.dropzone.addClass(this.config.classes.dropzoneActive),this.dragDropTracker[n]=!0},handleDragLeave:function(t){var n=e.one(t.target).generateID();t.stopImmediatePropagation(),t.preventDefault(),delete this.dragDropTracker[n],clearTimeout(this.dragLeaveTimeout),this.dragLeaveTimeout=setTimeout(function(){Object.keys(this.dragDropTracker).length===0&&this.dropzone&&this.dropzone.removeClass(this.config.classes.dropzoneActive)}.bind(this),100)},handleDrop:function(n){if(e.OverlayManager.ModalOverlay.alreadyShowingModal())return;n.stopImmediatePropagation(),n.preventDefault(),e.OverlayManager.ModalOverlay.close(),this.dropzone&&this.dropzone.removeClass(this.config.classes.dropzoneActive);var r;r=n.dataTransfer.items||n.dataTransfer.files,this.enqueueFiles(r),e.rapidTracker.beacon(t,"uploadrFileDropped",{count:r.length})},handleInputChange:function(e){e._event.target&&e._event.target.files&&this.enqueueFiles(e._event.target.files),this.filePickerInput.set("value","")},enqueueFiles:function(t){var n=[];if(!t)return;return t=this.normalizeFiles(t),n=t.map(function(t){var n=e.guid();return this.appContext.getModel("upload-file-models",n,{id:n,file:t})}.bind(this)),e.Promise.all(n).then(function(t){var n=this.validateFiles(t),r=[],i;n.valid.length&&e.UploadQueue.addToQueue(n.valid,this.appContext),n.invalid.forEach(function(t){i=new e.UploadError(e.UploadError.types.INVALID_FILE),t.addError(i),r.push(t)}.bind(this)),n.excess.forEach(function(t){i=new e.UploadError(e.UploadError.types.TOO_MANY_FILES),t.addError(i),r.push(t)}.bind(this)),r.length&&e.UploadQueue.addToFailedQueue(r,this.appContext),e.UploadQueue.beginProcessing()}.bind(this),function(t){e.Flog.error(t)})},normalizeFiles:function(e){var t=[],n,r,i;e.length||(e=[e]);for(n=0;n<e.length;n++){r=e[n];if(r.isFile||r.isDirectory)i=r;else if(r.getAsEntry)i=r.getAsEntry();else{if(!r.webkitGetAsEntry){if(typeof r.getAsFile=="function"){t.push(r.getAsFile());continue}if(Blob&&r instanceof Blob){t.push(r);continue}continue}i=r.webkitGetAsEntry()}if(!i)continue;i.isFile?r.getAsFile&&t.push(r.getAsFile()):i.isDirectory}return t},validateFiles:function(e){var t=[],n=[],r=[];return e.forEach(function(e){e.getValue("isValidFiletype")?e.getValue("isVideo")?this.config.allowVideo?this.config.allowedFileTypes.video[e.getValue("extension")]===-1?n.push(e):t.push(e):n.push(e):this.config.allowedFileTypes.photo.indexOf(e.getValue("extension"))===-1?n.push(e):t.push(e):n.push(e)}.bind(this)),t.length>this.config.maxNumFiles&&(r=t.slice(this.config.maxNumFiles),t=t.slice(0,this.config.maxNumFiles)),{valid:t,invalid:n,excess:r}},_fileAPIIsSupported:function(){return e.config.win.File&&e.config.win.FileList&&e.config.win.FileReader}},e.augment(e.UploadFilePicker,e.EventTarget)},"@VERSION@",{requires:["event-custom","flog","upload-file-models","upload-queue","upload-error","fluid-overlay-manager-view"]});
YUI.add("hermes-template-uploader-minimal",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="notification">\n	<div class="header">',u={hash:{intlName:"common.UPLOADING"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+'</div>\n	<div class="progress-bar"><div class="progress"></div></div>\n	<div class="progress-text"></div>\n	<a class="progress-cancel">',u={hash:{intlName:"common.CANCEL"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+'</a>\n</div>\n\n<div class="uploader-drop-zone">\n	<div class="drop-here">\n		<div class="uploader-centered-content">\n			<i></i>\n			<h5>',u={hash:{intlName:"common.UPLOAD_DROP_TARGET"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+"</h5>\n		</div>\n	</div>\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/uploader-minimal",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-uploader-minimal-errors",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var r="",i,s,o;r+="\n<p>",o={hash:{intlName:e.title},data:t},r+=a((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,o):f.call(e,"intlHTMLMessage",o)))+'</p>\n<div class="file-list-container">\n	<table>\n		<tbody>\n			',s=n.each.call(e,e.files,{hash:{},inverse:l.noop,fn:l.program(2,h,t),data:t});if(s||s===0)r+=s;return r+="\n		</tbody>\n	</table>\n</div>\n",r}function h(e,t){var r="",i;return r+='\n			<tr>\n				<th class="col100">',(i=n.filename)?i=i.call(e,{hash:{},data:t}):(i=e.filename,i=typeof i===u?i.apply(e):i),r+=a(i)+"</th>\n			</tr>\n			",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;o=n.each.call(t,t.errorList,{hash:{},inverse:l.noop,fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;return s+="\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/uploader-minimal-errors",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("uploader-minimal-view",function(e){e.namespace("Views")[this.name]=e.Base.create("uploader-minimal-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.numItemsUploadedForNotification=e.numItemsUploadedForNotification||Number.POSITIVE_INFINITY,this.firedInitialUploadsNotification=!1,this.willNavigateAfterInitialUpload=e.willNavigateAfterInitialUpload,this.uploadFilePicker=null,this.notification=null,this.dropzone=null,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var e={};return this.setContainerHTML(this.templates("uploader-minimal")(e)),this.notification=this.get("container").one(".notification"),this.dropzone=this.get("container").one(".uploader-drop-zone"),this},activate:function(){return this.initUI(),this.uploadFilePicker=new e.UploadFilePicker(null,this.appContext),this.handleEvents(),this},destructor:function(){this.uploadFilePicker&&this.uploadFilePicker.destroy()},reconnect:function(){var t=e.UploadQueue.getBatchProgress(),n=this.appContext.retrievePendingUploadErrorModal();t&&t.progress>0&&t.progress<1&&this.notification.addClass("active"),n&&this.showErrorModal(n)},initUI:function(){this.registerEventHandler(this.get("container").one(".progress-cancel").on("click",this.handleCancel.bind(this)))},updateNotificationUI:function(e){var t=Math.min((e.numComplete||0)+1,e.numFiles)+"",n=e.numFiles||"0",r=e.progress||"0";this.notification.one(".progress-bar > .progress").setStyle("width",r+"%"),this.notification.one(".progress-text").setHTML(this.intlMessage({intlName:"common.NUMERIC_PROGRESS_COUNT",progress:t,total:n}))},handleCancel:function(){this.uploadFilePicker.reset(!0)},handleEvents:function(){this.registerEventHandler(this.uploadFilePicker.on("start",this.onUploadStart.bind(this))),this.registerEventHandler(this.uploadFilePicker.on("progress",this.onUploadProgress.bind(this))),this.registerEventHandler(this.uploadFilePicker.on("complete",this.onUploadEnd.bind(this))),this.registerEventHandler(this.uploadFilePicker.on("canceled",this.onUploadEnd.bind(this)))},onUploadStart:function(e){this.onUploadProgress(e),this.notification.addClass("active"),this.fire("upload:start")},onUploadProgress:function(e){this.updateNotificationUI({progress:Math.ceil(e.progress*100),numComplete:e.numUploaded+e.numFailed,numFiles:e.numFiles}),!this.firedInitialUploadsNotification&&e.numUploaded>=this.numItemsUploadedForNotification&&this.notifyInitialItemsComplete()},onUploadEnd:function(e){var t=e&&e.uploaded?Object.keys(e.uploaded).length:0;this.notification.removeClass("active"),t&&!this.firedInitialUploadsNotification&&this.numItemsUploadedForNotification&&this.notifyInitialItemsComplete(),e&&e.failed&&Object.keys(e.failed).length&&this.displayErrors(e.failed),this.fire("upload:complete",{numUploaded:t})},displayErrors:function(t){var n={},r,i,s,o,u,a,f;for(i in t)r=t[i],r.getValue("errors").forEach(function(e){s=r.toJSON(),o=e.getUserFacingCategory(),n[o]||(n[o]={title:this.getIntlKeyForErrorCategory(o),files:[]}),u=n[o],u.files.push(s)}.bind(this));a=Object.keys(n).map(function(e){return n[e].files.sort(function(e,t){return e.filename<t.filename?-1:t.filename<e.filename?1:0}),n[e]}),f=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.UPLOAD_ERROR_TITLE"}),showActionButton:!0,showCancelButton:!1,classList:"uploader-minimal-view-error-dialog",htmlMessage:this.templates("uploader-minimal-errors")({errorList:a})}),this.firedInitialUploadsNotification&&this.willNavigateAfterInitialUpload?this.appContext.storePendingUploadErrorModal(f):this.showErrorModal(f)},showErrorModal:function(e){this.appContext.storePendingUploadErrorModal(null),e.show()},notifyInitialItemsComplete:function(){this.fire("subviewViewEvent","initialUploadsComplete"),this.firedInitialUploadsNotification=!0},getIntlKeyForErrorCategory:function(t){switch(t){case e.UploadError.userFacingCategories.INVALID_FILE:return"common.UPLOAD_ERROR_CATEGORY_INVALID";case e.UploadError.userFacingCategories.GENERIC:case e.UploadError.userFacingCategories.TOO_MANY_FILES:case e.UploadError.userFacingCategories.CANCELED:case e.UploadError.userFacingCategories.PROCESSING_ERROR:default:return"common.UPLOAD_ERROR_CATEGORY_GENERIC"}}})},"@VERSION@",{requires:["upload-file-picker","hermes-template-uploader-minimal","hermes-template-uploader-minimal-errors","uploader-minimal-css","fluid-modal-view","upload-error"],langBundles:["common"]});
