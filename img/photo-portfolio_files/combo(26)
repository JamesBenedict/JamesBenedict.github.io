YUI.add("albums-list-route",function(e){function i(e){i.superclass.constructor.call(this,e)}var t=25,n=50,r=100;e.Routes[this.name]=i,e.extend(i,e.FlickrRoute,{langBundles:this.details.langBundles,run:function(i){var s=this,o={},u,a,f=i.params.nsid_or_path_alias,l=i.params&&i.params.set_id,c=l?r:t,h=this.getPageNumber(i),p;return e.TypeValidator.matches.nsid(f)?o.id=f:o.pathAlias=f,a="/photos/"+f+"/albums/",u={page:r/c*(h-1)+1,perPage:c,withSetId:l},e.Promise.all([this.appContext.getModel("sets-models",o,u),this.appContext.getModel("person-models",o),this.appContext.getModel("person-contacts-count-models",o)]).then(function(t){var o=t[0],f=t[1],c=0;if(YUI.Env.isServer){c=Math.ceil(o.getValue("totalItems")/r);if(h>c&&u.page>1&&!isNaN(parseInt(i.params.page_number,10)))return e.Promise.resolve({redirect:a.replace(/page[0-9]+/,"")})}if(l){var d=o.getValue("albumsList");p=d.getPageOf({id:l},n);if(p===-1||d.getNextIncompletePage(u)===p)return u.forceAPICall=!0,d.getPage(u).then(function(e){return h=Math.ceil(d.getPageOf({id:l},n)*n/r),p=h,s.onRouteResolved(o,f,h,p,a,l)},function(e){return s.onRouteRejected(e,i)});h=Math.ceil(p*n/r),p=h}else p=r/n*(h-1)+1;return s.onRouteResolved(o,f,h,p,a,l)},function(e){return s.onRouteRejected(e,i)})},onRouteResolved:function(t,i,s,o,u,a){var f,l=t.getValue("totalItems"),c=i.getValue("displayname");return parseInt(l,10)===0&&this.appContext.flipper.isFlipped("enable-new-empty-state-pages")?f={view:"empty-page-view",fluid:!0,layout:"scrolling",title:this.intlMessage({intlName:"common.USERS_ALBUMS",who:c}),params:{displayName:c,nsid:i.getValue("nsid"),page:"albums"}}:f={view:"albums-list-page-view",fluid:!0,layout:"scrolling",title:this.intlMessage({intlName:"common.USERS_ALBUMS",who:c}),params:{nsid:t.id,withSetId:a,pageParams:{page:o,perPage:a?r:n,viewPageSize:r,nominalPage:s},baseURL:u}},e.Promise.resolve(f)},onRouteRejected:function(t,n){var r=n.params.nsid_or_path_alias,i="Couldn't load albums list page",s=this.appContext.getViewer().nsid;if(r==="me"&&s)return e.Promise.resolve({redirect:"/photos/"+s+"/albums/"});t.message&&(i+=": "+t.message);if(t.fatal)throw t;return this.displayRouteErrors(n,new e.RouteError(404,i))}}),e.mix(i.prototype,e.Localizable)},"@VERSION@",{requires:["flickr-route","flickr-promise","sets-models","person-models","type-validator"],langBundles:["common"]});
